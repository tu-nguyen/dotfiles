#!/usr/bin/env bash
# ===================================================================== #
# BASH ALIASES
# ===================================================================== #
# aliases cause you're a lazy pos smfh
uname="$(uname)"
# ------------------------------------------
# Safety & Administrative
# ------------------------------------------
# Escalation shortcuts
alias root='sudo -i'
alias su='sudo -i'
alias svi='sudo vi'

# Automatic sudo for system commands if not root
if (( EUID != 0 )); then
    alias reboot='sudo reboot'

    # Package manager detection
    if [[ "$uname" == "Darwin" ]]; then
        # macos: use homebrew for 'update'
        if command -v brew &>/dev/null; then
            alias update='brew update && brew upgrade'
        fi
    else
        if command -v apt-get &>/dev/null; then
            alias update='sudo apt-get update && sudo apt-get upgrade'
        elif command -v pacman &>/dev/null; then
            alias update='sudo pacman -Syu'
        fi
    fi

    # Firewall / iptables (Guard for macos)
    if [[ "$uname" == "Darwin" ]]; then
        # macos: use pfctl equivalents
        alias ipt='sudo pfctl'
        alias iptlist='sudo pfctl -s rules'
        alias firewall='sudo pfctl -s info'
    else
        IPT_BIN=$(command -v iptables 2>/dev/null || echo "/usr/sbin/iptables")

        alias ipt="sudo $IPT_BIN"
        alias iptlist="sudo $IPT_BIN -L -n -v --line-numbers"
        alias iptlistin="sudo $IPT_BIN -L INPUT -n -v --line-numbers"
        alias iptlistout="sudo $IPT_BIN -L OUTPUT -n -v --line-numbers"
        alias iptlistfw="sudo $IPT_BIN -L FORWARD -n -v --line-numbers"
        alias firewall=iptlist
    fi
fi

# macos compatibility for timeout
[[ "$uname" == "Darwin" ]] && alias timeout=gtimeout

# Prevent catastrophic accidents on root
alias chown='chown --preserve-root'
alias chmod='chmod --preserve-root'
alias chgrp='chgrp --preserve-root'

# Interactive safety (stops accidental overwrites)
alias cp='cp -iv'
alias ln='ln -iv'
alias mv='mv -iv'

# -I prompts once before removing more than three files
alias rm='rm -Iv --one-file-system --preserve-root'
alias rmd='rm -rfv'

# ------------------------------------------
# Navigation & Listing
# ------------------------------------------
alias c='clear'
alias cls='clear && ls'
alias clss='clear && lsa'
alias h='history'
alias x='exit'

# cat
# alias qat='/usr/bin/cat'
# alias cat='bat --paging=never --force-colorization'
alias qat="$(command -v cat)"
alias cat="$(command -v batcat || command -v bat || echo 'cat') --paging=never --force-colorization"

# cd
alias home="cd ~"
alias ~="home"
alias cd~="home"
alias ..="cd .."
alias ...="cd ../.."
alias ....="cd ../../.."
alias .4="cd ../../../.."
alias .5="cd ../../../../.."

# Open folder
if [[ "$uname" == "Darwin" ]]; then
    alias f='open -a Finder'
else
    alias f='explorer.exe'
fi

# ls variants (colorized)
unset -f ls 2>/dev/null
if command -v eza >/dev/null 2>&1; then
    alias ls='eza --group-directories-first --color=always --icons'
else
    # Fallback to standard ls logic if eza is missing
    if [[ "$(uname)" == "Darwin" ]]; then
        alias ls='ls -Gph'
    else
        alias ls='ls -Fph --color=auto --group-directories-first'
    fi
fi
alias l='ls'
alias ll='ls -lh'
alias la="ls -aAlh"
alias lla='ls -Alh'
alias lsd="ls -d */"
alias ldir="lsd"
alias lsa="ls -la"
alias ld='ls -d */'              # list only directories
alias lsd='ls -d */'              # list only directories
alias lt='ls -Alht'               # sort by time (newest first)
alias labc='ls -lap'              # sort by alphabetical
alias lf="ls -l | egrep -v '^d'"  # show files only
alias l.='ls -d .* -G'            # show only hidden files

# grep
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'
alias diff='diff --color=auto'

# ------------------------------------------
# System Monitoring & Tools
# ------------------------------------------
# Installer
alias p="sudo pacman"
alias y="yaourt"

# Lang
alias rb='ruby'
alias py='python'

# Vim
alias v='vim'
alias svi='sudo vi'
alias vis='vim "+set si"'
alias edit='vim'
alias ebrc='vim ~/.bashrc'
alias vb='vim ~/.bashrc'
alias vimh='vim -c ":h | only"'
alias vc='vim $DOTFILES_CONFIG_FILE'
alias vdot='vim $DOTFILES_CONFIG_FILE'

# Code
alias c.='code .'

# Resource usage
alias ps='[[ "$uname" == "Darwin" ]] && ps aux || ps auxf'
alias j='jobs -l'
alias df='df -H'
alias du='du -ch'
alias top='htop'
alias top10='[[ "$uname" == "Darwin" ]] && ps -arcwwwxo pid,comm,%cpu,%mem | head -n 11 || ps -eo pid,comm,%cpu,%mem --sort=-%cpu | head -n 11'
alias uptime='[[ "$uname" == "Darwin" ]] && uptime || uptime -p'
alias nowtime='date +"%T"'
alias nowdate='date +"%d-%m-%Y"'
alias path='echo -e ${PATH//:/\\n}'
alias dmesg10='sudo dmesg | tail -n 10'
# alias folder="find . -maxdepth 1 -type d -print | xargs du -sk | sort -rn"
alias folder="du -sh */ | sort -rh"
alias wc='wc -l -w -c'
alias tree='tree -CAhF --dirsfirst'
alias treed='tree -CAFd'
alias mountedinfo='df -hT'
alias fkill="ps -e | fzf | awk '{print $1}' | xargs kill"
if ! command -v cpu &> /dev/null; then
    cpu_speed_mhz=$(wmic.exe cpu get MaxClockSpeed 2>/dev/null | tail -n +2 | tr -d '\r' | xargs)
    alias cpu="$(echo "$cpu_speed_mhz" | awk '{printf "%.3f", $1/1000}')Ghz"
fi

# Networking
alias myip="curl -s icanhazip.com"
alias ping='ping -c 5'
alias p4="ping 4.2.2.2 -c 4"
alias ports='[[ "$uname" == "Darwin" ]] && netstat -tulanp || ss -tulanp'
alias header='curl -I'  # get web server headers
alias headerc='curl -I --compress'  # find out if remote server supports gzip / mod_deflate or not
alias dnstop='dnstop -l 5  eth1'  # all of our servers eth1 is connected to the internets via vlan / router etc
alias vnstat='vnstat -i eth1'
alias iftop='iftop -i eth1'
alias tcpdump='tcpdump -i eth1'
alias ethtool='ethtool eth1'
# Work on wlan0 by default #
# Only useful for laptop as all servers are without wireless interface
alias iwconfig='iwconfig wlan0'
alias speedtest="wget -O /dev/null http://speed.transip.nl/100mb.bin"
if ! command -v host &> /dev/null; then
    alias host="sudo $EDITOR /etc/hosts"
    alias hosts="sudo $EDITOR /etc/hosts"
fi

# chmod
alias mx='chmod a+x'
alias 000='chmod -R 000'
alias 644='chmod -R 644'
alias 666='chmod -R 666'
alias 755='chmod -R 755'
alias 777='chmod -R 777'

# # python and uv
# commented out, using 'uv python link 3.13' instead
# alias python3='uv run --python 3.13 python3'
# alias python='uv run --python 3.13 python'

# irc
alias irc='${IRC_CLIENT:-irc}'

# ------------------------------------------
# Archives (The "I always forget the flags" section)
# ------------------------------------------
alias mktar='tar -cvf'
alias mkbz2='tar -cvjf'
alias mkgz='tar -cvzf'
alias untar='tar -xvf'
alias unbz2='tar -xvjf'
alias ungz='tar -xvzf'

# ------------------------------------------
# Git Shortcuts
# ------------------------------------------
# Note: These assume you have these aliases defined in your .gitconfig as well
# push, pull, checkout, check -b, rename in .bash_functions
alias ga='git a'
alias gb='git b'
alias gbr='git br'
# alias gbr='git branch -vv --color=always | fzf --ansi | awk "{print \$1}" | sed "s/* //" | tr -d "\n" | (pbcopy 2>/dev/null || clip.exe 2>/dev/null || xclip -sel clip 2>/dev/null)'
alias gbd='git branch -D'
alias gd='git branch -D'
alias grm='git branch -D'
alias gc='git cam'
alias gcl='git cl'
alias gl="git l"
alias gll="git ll"
alias grr="git rr"
alias gs='git st'
alias greset='git reset --hard HEAD'
alias gclean='git clean -f'
alias gclone='git clone'
alias gf='git fetch'
alias gfetch='git fetch'

# ------------------------------------------
# Other
# ------------------------------------------
# composer
alias coi='composer install'
alias corem='composer remove'
alias coup='composer update'
alias coupg='composer upgrade'
alias cols='composer list'

# fnm / npm / node
alias update-node='fnm install --lts && LTS_VER=$(fnm list | grep "lts-latest" | awk "{print \$2}") && fnm default "$LTS_VER" && date +%s > "$DOTFILES_CONFIG_DIR/.node_update_timestamp" && echo "Node LTS updated to $LTS_VER"'
alias nr='npm run'
alias nls='npm list --depth=0 2>/dev/null'
alias ni='npm install'
alias nis='npm install --save'
alias nu='npm uninstall'
alias nus='npm uninstall --save'
alias nup='npm update'

alias so0="cmatrix"
# alias mv='timeout 8 mv -iv'
# alias rm='timeout 3 rm -Iv --one-file-system --preserve-root'
# alias rmd='rm  --recursive --force --verbose '
# alias mkdir='mkdir -pv'

if command -v colordiff >/dev/null 2>&1; then
    alias diff='colordiff'
    # side-by-side comparison
    alias diffy='colordiff -y -W $(tput cols)'
fi
