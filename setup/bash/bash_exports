#!/usr/bin/env bash
# ===================================================================== #
# BASH EXPORTS
# ===================================================================== #

# ------------------------------------------
# Path & Language Settings
# ------------------------------------------
# append path
path_append() {
    if [[ -d "$1" ]] && [[ ":$PATH:" != *":$1:"* ]]; then
        export PATH="$PATH:$1"
    fi
}

# prepend path
path_prepend() {
    if [[ -d "$1" ]] && [[ ":$PATH:" != *":$1:"* ]]; then
        export PATH="$1:$PATH"
    fi
}

# standard paths
path_prepend "$HOME/.local/bin"
path_prepend "/usr/local/bin"

# ------------------------------------------
# Language Specifics
# ------------------------------------------
# java/android (adjust paths based on your installation)
[[ -d "/opt/android-sdk" ]] && export ANDROID_HOME="/opt/android-sdk"
# on linux, JAVA_HOME is often /usr/lib/jvm/default-java
# on macos, it is often /usr/bin/java (symlink)
export JAVA_HOME="/usr"

# export PATH=$PATH:$HOME/.local/bin
# export PATH=/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:$PATH
# export PYTHONPATH="$(which python3):$PYTHONPATH"

# ------------------------------------------
# macos Specifics (Darwin)
# ------------------------------------------
if [[ "$(uname)" == "Darwin" ]]; then
    # silicon homebrew (m1/m2/m3)
    path_prepend "/opt/homebrew/bin"
    path_prepend "/opt/homebrew/sbin"

    # force gnu make over apple's old version
    path_prepend "$(brew --prefix)/opt/make/libexec/gnubin"

    # python & tooling
    path_prepend "$(brew --prefix)/opt/python@3.13/bin"
    path_prepend "$HOME/Library/Python/3.13/bin"

    export HOMEBREW_NO_ENV_HINTS=1
fi

# ------------------------------------------
# History Configuration
# ------------------------------------------
export HISTCONTROL=ignoredups:ignorespace  # don't save duplicates or lines starting with space
export HISTSIZE=10000                      # commands to remember in the current session
export HISTFILESIZE=20000                  # commands to keep in the history file
# sync history across all open terminals after every command
export PROMPT_COMMAND="history -a; $PROMPT_COMMAND"

# store multi-line commands as one entry
shopt -s cmdhist

# append to history file immediately rather than overwriting on exit
shopt -s histappend

# ------------------------------------------
# System & Localization
# ------------------------------------------
export COLORTERM=truecolor
export LANG='en_US.UTF-8'
export LC_ALL='en_US.UTF-8'

export VISUAL=vim
export EDITOR=vim
export PAGER="less"

# only set TERM if it's not already set to something modern
# (forcing screen-256color can break TrueColor support in some terminals)
if [[ "$TERM" == "dumb" ]] || [[ -z "$TERM" ]]; then
    export TERM="xterm-256color"
fi

# ------------------------------------------
# UI & Pager (less)
# ------------------------------------------
# colorized man pages for better readability
export LESS_TERMCAP_mb=$'\E[01;31m'      # start blink
export LESS_TERMCAP_md=$'\E[01;31m'      # start bold
export LESS_TERMCAP_me=$'\E[0m'          # end mode
export LESS_TERMCAP_se=$'\E[0m'          # end standout
export LESS_TERMCAP_so=$'\E[01;44;33m'   # start standout (blue/yellow)
export LESS_TERMCAP_ue=$'\E[0m'          # end underline
export LESS_TERMCAP_us=$'\E[01;32m'      # start underline (green)
