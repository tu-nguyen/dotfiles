#!/usr/bin/env bash
# ===================================================================== #
# BASH STYLE
# ===================================================================== #

if [[ -n "$BASH_STYLE_LOADED" ]]; then
    return
fi
BASH_STYLE_LOADED=1

# color support detection
if [[ "$COLORTERM" == "truecolor" || "$COLORTERM" == "24bit" ]]; then
    COLOR_MODE="hex"
elif [[ "$TERM" == *"256color"* ]]; then
    COLOR_MODE="256"
else
    COLOR_MODE="basic"
fi

# Function to set foreground
_set_fg() {
    local hex_in=$1; local basic=$2
    local hex="${hex_in#\#}" # Strip #

    # Apple terminal (force 256)
    if [[ "$TERM_PROGRAM" == "Apple_Terminal" ]]; then
        echo -ne "\033[38;5;$(_hex_to_256 "$hex")m"

    # 256 mode
    elif [[ "$COLOR_MODE" == "256" ]]; then
        echo -ne "\033[38;5;$(_hex_to_256 "$hex")m"

    # Hex mode
    elif [[ "$COLOR_MODE" == "hex" ]]; then
        local r=$((16#${hex:0:2}))
        local g=$((16#${hex:2:2}))
        local b=$((16#${hex:4:2}))
        echo -ne "\033[38;2;${r};${g};${b}m"

    # Fallback to standard ansi
    else
        tput setaf "$basic" 2>/dev/null || echo -ne "\033[3${basic}m"
    fi
}

# Function to set background
_set_bg() {
    local hex_in=$1; local basic=$2
    local hex="${hex_in#\#}" # Strip #

    if [[ "$TERM_PROGRAM" == "Apple_Terminal" ]]; then
        echo -ne "\033[48;5;$(_hex_to_256 "$hex")m"
    elif [[ "$COLOR_MODE" == "256" ]]; then
        echo -ne "\033[48;5;$(_hex_to_256 "$hex")m"
    elif [[ "$COLOR_MODE" == "hex" ]]; then
        local r=$((16#${hex:0:2}))
        local g=$((16#${hex:2:2}))
        local b=$((16#${hex:4:2}))
        echo -ne "\033[48;2;${r};${g};${b}m"
    else
        tput setab "$basic" 2>/dev/null || echo -ne "\033[4${basic}m"
    fi
}

# Function to attribute
_set_attr() {
    tput "$1" 2>/dev/null || echo -ne "$2"
}

# Formatting
NC=$(_set_attr "sgr0" "\033[0m")
RESET=$(_set_attr "sgr0" "\033[0m")
BOLD=$(_set_attr "bold" "\033[1m")
DIM=$(_set_attr "dim" "\033[2m")
ITALIC=$(_set_attr "sitm" "\033[3m")
UNDERLINE=$(_set_attr "smul" "\033[4m")

# Text colors (foreground)
BLACK=$(_set_fg '#282828' 0)
RED=$(_set_fg '#cc241d' 1)
GREEN=$(_set_fg '#689d6a' 2)
YELLOW=$(_set_fg '#d79921' 3)
BLUE=$(_set_fg '#0000ff' 4)
MAGENTA=$(_set_fg '#b16286' 5)
CYAN=$(_set_fg '#00ffff' 6)
WHITE=$(_set_fg '#ffffff' 7)
GRAY=$(_set_fg '#928374' 8)
PINK=$(_set_fg '#ffc0cb' 5) # fallback to magenta if no pink available
LIGHT_PINK=$(_set_fg '#ffb6C1' 217)  # soft, light rose
DARK_PINK=$(_set_fg '#e75480' 168)   # deep, punchy rose
HOT_PINK=$(_set_fg '#ff10f0' 201)   # high-contrast "neon" pink
PASTEL_PINK=$(_set_fg '#ffd1dc' 224) # very soft, creamy pink

# Bright colors (if your terminal supports them)
BRIGHT_RED=$(_set_fg '#fb4934' 9)
BRIGHT_GREEN=$(_set_fg '#b8bb26' 10)
BRIGHT_YELLOW=$(_set_fg '#fabd2f' 11)
BRIGHT_BLUE=$(_set_fg '#83a598' 12)
BRIGHT_MAGENTA=$(_set_fg '#d3869b' 13)
BRIGHT_CYAN=$(_set_fg '#41fdfe' 14)

# Background
ON_BLACK=$(_set_bg '#282828' 0)
ON_RED=$(_set_bg '#cc241d' 1)
ON_GREEN=$(_set_bg '#689d6a' 2)
ON_YELLOW=$(_set_bg '#d79921' 3)
ON_BLUE=$(_set_bg '#0000ff' 4)
ON_MAGENTA=$(_set_bg '#b16286' 5)
ON_CYAN=$(_set_bg '#00ffff' 6)
ON_WHITE=$(_set_bg '#ffffff' 7)
ON_PINK=$(_set_bg '#ffc0cb' 5)
ON_BRIGHT_RED=$(_set_bg '#fb4934' 9)
ON_BRIGHT_GREEN=$(_set_bg '#b8bb26' 10)
ON_BRIGHT_YELLOW=$(_set_bg '#fabd2f' 11)
ON_BRIGHT_BLUE=$(_set_bg '#83a598' 12)
ON_BRIGHT_MAGENTA=$(_set_bg '#d3869b' 13)
ON_BRIGHT_CYAN=$(_set_bg '#41fdfe' 14)

# Status
OK="${BOLD}${PINK}"
SUCCESS="${BOLD}${PINK}"
INFO="${PINK}"
WARN="${BOLD}${YELLOW}"
ERR="${BOLD}${RED}"
DEBUG="${DIM}"
ALERT="${BOLD}${WHITE}${ON_RED}"  # bold white on red background

MAIN_C=${MAIN_C:=${PINK}}
SUB_C=${SUB_C:=${CYAN}}
ACCENT_C=${ACCENT_C:=${PASTEL_PINK}}

# Structure styles
HDR_F="${BOLD}${MAIN_C}"  # main headers
SUB_F="${BOLD}${SUB_C}"  # secondary headers
KEY_F="${MAIN_C}"  # labels/keys
VAL_F="${WHITE}"  # data values
DIM_F="${DIM}"  # data values
SEP_F="${GRAY}"  # separator
SEL_F="${BOLD}${WHITE}"  # selection/choice

# Type styles
DIR_F="${SUB_C}"  # Directories
FILE_F="${ACCENT_C}"  # Files
EXE_F="${BOLD}${MAIN_C}"  # Executables/scripts
ARGS_F="${DIM}"  # Args/Options

# Other
NOTICE_F="${BOLD}${ON_BLUE}${WHITE}" # attention-grabbing banners
URL_F="${UNDERLINE}${BLUE}" # links

# backward compat with my old Makefile/settings
H="${HDR_F}"
H2="${SUB_F}"
S="${KEY_F}"
S2="${VAL_F}"

# example usage
# echo "${RED}This is red text${NC}"
# echo "${BOLD}${WHITE}This is bold edwhite text ${NC}"
# echo "${BLUE}${ON_PURPLE}This is blue text on purple background${NC}"

if [[ "$OSTYPE" == "macos"* ]]; then
    MOTD_F="${MAGENTA}"
elif [[ "$OSTYPE" == "wsl" ]]; then
    MOTD_F="${PINK}"
else
    MOTD_F="${PASTEL_PINK}"
fi

# Theme switcher
set_theme() {
    local theme=$1

    case $theme in
        "main")
            MAIN_C='#ffc0cb' # pink
            SUB_F='#00ffff'  # aqua/cyan
            ACCENT_C='#ffd1dc' # pastel
            echo "Mood: Cyberpunk active."
            ;;
        "cyber")
            MAIN_C='#ff10f0' # neon pink
            SUB_F='#00ffff'  # aqua/cyan
            ACCENT_C='#ffd1dc' # pastel
            echo "Mood: Cyberpunk active."
            ;;
        "nord")
            MAIN_C='#88c0d0' # frost blue
            SUB_F='#81a1c1'  # arctic blue
            ACCENT_C='#d8dee9' # snow white
            echo "Mood: Arctic chill active."
            ;;
        "dracula")
            MAIN_C='#bd93f9' # purple
            SUB_F='#50fa7b'  # green
            ACCENT_C='#ff79c6' # pink
            echo "Mood: Vampire mode."
            ;;
        "monokai")
            MAIN_C='#f92672'   # vivid pink
            SUB_F='#a6e22e'    # bright green
            ACCENT_C='#66D9ef' # sky blue
            echo "Mood: Classic pro mode."
            ;;
        "forest")
            MAIN_C='#2d5a27'   # deep pine
            SUB_F='#9bc693'    # sage
            ACCENT_C='#e9ffdb' # off-white
            echo "Mood: Woodland focus."
            ;;
        "tokyo-night")
            MAIN_C='#7aa2f7'   # storm blue
            SUB_F='#bb9af7'    # magenta/purple
            ACCENT_C='#c0caf5' # soft silver
            echo "Mood: Tokyo neon lights."
            ;;
        "matrix")
            MAIN_C='#00ss41'   # matrix green
            SUB_F='#003b00'    # dark green
            ACCENT_C='#0Dd0208' # black
            echo "Mood: Wake up, Neo."
            ;;
        *)
            echo "Usage: set_theme [main|cyber|nord|dracula|monokai|forest|tokyo-night|matrix]"
            return 1
            ;;
    esac

    # Re-assign the core colors using your set_fg helper
    NEW_HDR_F=$(_set_fg "$MAIN_C" 5)
    NEW_SUB_F=$(_set_fg "$SUB_F" 6)
    NEW_KEY_FK=$(_set_fg "$ACCENT_C" 7)

    # Refresh the ui presets
    HDR_F="${BOLD}${NEW_HDR_F}"
    SUB_F="${BOLD}${NEW_SUB_F}"
    KEY_F="${NEW_KEY_FK}"
    H="${HDR_F}"
    H2="${SUB_F}"
}

# Set color for ls
# export LS_COLORS="di=36:ex=38;2;255;192;203:*.py=38;2;255;192;203:*.sh=38;2;255;192;203:*.js=38;2;255;192;203"
export EZA_COLORS="uu=38;2;255;182;193:un=38;2;255;182;193:gu=02;36:gn=02;36:da=02;37:ux=1;38;2;255;182;193:hd=1;38;2;255;182;193"

# Color verification test
color_test() {
    echo -e "${BOLD}Current Mode:${NC} $COLOR_MODE (TERM: $TERM)\n"
    echo -e "${BOLD}Primary Colors: ${NC}${PINK}PINK ${RED}RED ${GREEN}GREEN ${YELLOW}YELLOW ${BLUE}BLUE ${MAGENTA}MAGENTA ${CYAN}CYAN ${WHITE}WHITE ${GRAY}GRAY ${NC}\n"
    echo -e "${BOLD}Bright Colors: ${NC}${PASTEL_PINK}PASTEL_PINK ${BRIGHT_RED}B_RED ${BRIGHT_GREEN}B_GREEN ${BRIGHT_YELLOW}B_YELLOW ${BRIGHT_BLUE}B_BLUE ${BRIGHT_MAGENTA}B_MAGENTA ${BRIGHT_CYAN}B_CYAN${NC}\n"
    echo -e "${BOLD}Backgrounds: ${NC}${BLACK}${ON_PINK}ON_PINK${NC} ${BLACK}${ON_RED}ON_RED${NC} ${BLACK}${ON_GREEN}ON_GREEN${NC} ${BLACK}${ON_YELLOW}ON_YELLOW${NC} ${BLACK}${ON_BLUE}ON_BLUE${NC} ${BLACK}${ON_MAGENTA}ON_MAGENTA${NC} ${BLACK}${ON_CYAN}ON_CYAN${NC} ${BLACK}${ON_WHITE}ON_WHITE${NC}\n"
    echo -e "${BOLD}Current Setting:${NC}"
    echo -e "${OK}OK         ${HDR_F}HDR_F${NC}         ${H}H${NC}"
    echo -e "${SUCCESS}SUCCESS${NC}    ${SUB_F}SUB_F${NC}         ${H2}H2${NC}"
    echo -e "${INFO}INFO${NC}       ${KEY_F}KEY_F${NC}         ${S}S${NC}"
    echo -e "${WARN}WARN${NC}       ${VAL_F}VAL_F${NC}         ${S2}S2${NC}"
    echo -e "${ERR}ERR${NC}        ${DIM_F}DIM_F${NC}         ${NOTICE_F}NOTICE_F${NC}"
    echo -e "${DEBUG}DEBUG${NC}      ${SEP_F}SEP_F${NC}         ${URL_F}URL_F${NC}"
    echo -e "${ALERT}ALERT${NC}      ${SEL_F}SEL_F${NC}"
}
